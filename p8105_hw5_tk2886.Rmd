---
title: "p8105_hw5_tk2886"
author: "Tanvir Khan"
date: 11/13/2021
output: github_document
---

```{r message = FALSE, echo = FALSE}
library(tidyverse)
library(purrr)

## Set Global Options 
knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6, 
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```



# Problem 1

```{r}
homicide_data <-
  read_csv(file = "./homicide-data.csv")
```
**Analysis: ** Based on the raw data, there is 52,179 victims in the 50 large U.S. cities. The data includes the location of the killing, in most cases, basic demographic information about each victim.


# clean the data, added a column called city_state, and grouped by city 
```{r}
homicide_dfc <- 
  homicide_data %>%
  janitor::clean_names() %>%
  mutate(city_state = str_c(city, state, sep = ",")) %>%
  group_by(city)

homicide_dfc
```



# displays the total homicide count for each city and the total unsolved homicides for specific disposition
```{r}
homicides_summmary <-
  homicide_dfc %>%
  summarise(total_homicide = n(), 
            unsolved_homicide = sum(
              disposition == "Closed without arrest" | disposition == "Open/No arrest"))
```



# created a r code that outputs the total homicide count and the total unsolved homicide in Baltimore, MD. 
```{r}
baltimore_homicide <-
  homicide_dfc %>%
  filter(city == "Baltimore") %>%
  summarize(total_homicide_bm = n(),
            unsolved_homicide_bm = sum(disposition == "Closed without arrest" | disposition == "Open/No arrest"))

baltimore_homicide
```





```{r}
baltimore_statistics <-
  prop.test(x = pull(baltimore_homicide, unsolved_homicide_bm), n = pull(baltimore_homicide, total_homicide_bm))
```




# pulled estimate proportions, confidence intervals 
```{r}
baltimore_statistics %>%
  broom::tidy() %>%
  select(estimate, conf.low, conf.high)
```


```{r}

```









# Problem 2 



### Using the list.files function to gather all file names in the specified directory
```{r}
file_name_list = list.files("./data")


study_df <- tibble(files = file_name_list)
```



### Creating an iteration function 
```{r}
csv_iteration = 
  function(data_files) {
  participant_data = 
    read_csv(file = paste0("./data/", data_files)) %>% 
    mutate(experiment_group = data_files)
  }
```



### Merging all the file data 
```{r message = FALSE}
merging_data = 
  map_df(file_name_list, csv_iteration) 
```



### Tidying the data 
```{r}
arm_dfc <-
  merging_data %>%
  janitor::clean_names() %>%
  gather(key = week, value = arm_val, week_1:week_8) %>%
  separate(experiment_group, into = c("experiment_group", "subject_id"), sep = "_") %>%
  mutate(experiment_group = recode(experiment_group, 
                    "con" = "Control",
                    "exp" = "Experiment")) %>%
  mutate(week = str_remove(week, "week_")) %>%
  mutate(week = as.integer(week)) %>%
  mutate(subject_id = str_remove(subject_id, ".csv")) %>% 
  mutate(subject_id = as.integer(subject_id)) %>%
  mutate(across(.cols = c(experiment_group, subject_id, week), as.factor)) %>%
  select(experiment_group, subject_id, arm_val, week)

```



### Creating the Spaghetti Plot and seperating by control and experiment group 
```{r}
arm_dfc %>%
  ggplot(aes(x = week, y = arm_val, color = subject_id)) + 
  geom_point(size = .5) + 
  geom_line(aes(group = subject_id),  alpha = .5) + 
  facet_grid(~experiment_group) +
  labs(
    title = "Observations on each subject over time for Control and Experiment Group",
    x = "Week",
    y = "Arm Value",
    caption = "Longitudinal study that includes a control arm and an experimental arm") +
  viridis::scale_color_viridis(
    name = "Subject ID", 
    discrete = TRUE
  )
```
### Analysis of plot: The arm value for experiment group increases from week 1 to week 8 for all subjects. It is important to state in some weeks the arm value decreases for specific subjects but when comparing from week 1 to week 8, the arm value increases for all subjects. The arm value for control group for each subject fluctuates from week 1 to week 8. THere is no clear pattern for the control group because sometimes the arm value will increase then another week the value will decerase and then increase again. 




# Problem 3



### Code was provided by professor 
```{r}
set.seed(10)

iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species))
```



### Creating a function 
```{r}
iris_function = function(x) {
  if (!is.numeric(x) & !is.character(x)) {
    stop("Argument should be numeric or character")
 } else if (is.numeric(x)) {
   replace_na(x, round(mean(x, na.rm = TRUE),2))
 } else if (is.character(x)) {
   replace_na(x, "virginica")
 }}
```
#### Function first checks if the argument that is passed in is a numeric or character and if it is true, then we go to the next conditional statement block or else the function will stop and display an error message.



```{r}
map_dfr(iris_with_missing, iris_function)
```
#### I used map_dfr because this function directly binds the rows when map output is a dataframe or a named vector.
